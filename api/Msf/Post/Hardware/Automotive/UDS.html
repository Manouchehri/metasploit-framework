<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Msf::Post::Hardware::Automotive::UDS
  
    &mdash; Documentation by YARD 0.9.8
  
</title>

  <link rel="stylesheet" href="../../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Msf::Post::Hardware::Automotive::UDS";
  relpath = '../../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../../_index.html">Index (U)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../../Msf.html" title="Msf (module)">Msf</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../Post.html" title="Msf::Post (class)">Post</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Hardware.html" title="Msf::Post::Hardware (module)">Hardware</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Automotive.html" title="Msf::Post::Hardware::Automotive (module)">Automotive</a></span></span>
     &raquo; 
    <span class="title">UDS</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Msf::Post::Hardware::Automotive::UDS
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/msf/core/post/hardware/automotive/uds.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_dtcs-instance_method" title="#clear_dtcs (instance method)">#<strong>clear_dtcs</strong>(bus, srcId, dstId, opt = {})  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clears the DTCs and Resets the MIL light back to the off position.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_calibration_id-instance_method" title="#get_calibration_id (instance method)">#<strong>get_calibration_id</strong>(bus, srcId, dstId)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the vehicle calibration ID and returns it as an ASCII string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_current_data-instance_method" title="#get_current_data (instance method)">#<strong>get_current_data</strong>(bus, srcId, dstId, pid, opt = {})  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shows the vehicles current data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_current_data_pids-instance_method" title="#get_current_data_pids (instance method)">#<strong>get_current_data_pids</strong>(bus, srcId, dstId)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all supported pids for current data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_dtcs-instance_method" title="#get_dtcs (instance method)">#<strong>get_dtcs</strong>(bus, srcId, dstId, opt = {})  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the Diagnostic Trouble Codes (DTCs).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ecu_name-instance_method" title="#get_ecu_name (instance method)">#<strong>get_ecu_name</strong>(bus, srcId, dstId)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the vehicles ECU name pid 0x0A.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_engine_coolant_temp-instance_method" title="#get_engine_coolant_temp (instance method)">#<strong>get_engine_coolant_temp</strong>(bus, srcId, dstId)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the engine coolant temprature in both Celcious and Fahrenheit.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_freeze_frame_data-instance_method" title="#get_freeze_frame_data (instance method)">#<strong>get_freeze_frame_data</strong>(bus, srcId, dstId, pid, frame, opt = {})  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shows the vehicles freeze frame data, Use the same PIDs as supported from
Mode $01 #get_current_data_pids.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_monitor_status-instance_method" title="#get_monitor_status (instance method)">#<strong>get_monitor_status</strong>(bus, srcId, dstId)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Mode $01 Pid $01 gets and parses the monitor status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_obd_standards-instance_method" title="#get_obd_standards (instance method)">#<strong>get_obd_standards</strong>(bus, srcId, dstId)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return which OBD standard this bus confirms to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_rpms-instance_method" title="#get_rpms (instance method)">#<strong>get_rpms</strong>(bus, srcId, dstId)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the engine&#39;s current RPMs.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_security_token-instance_method" title="#get_security_token (instance method)">#<strong>get_security_token</strong>(bus, srcId, dstId, level = 1)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Retrieves the security access token.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_vehicle_info-instance_method" title="#get_vehicle_info (instance method)">#<strong>get_vehicle_info</strong>(bus, srcId, dstId, mode, opt = {})  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Requests diagnostics 0x09 vehicle information for any given mode No
formatting is done on the response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_vehicle_speed-instance_method" title="#get_vehicle_speed (instance method)">#<strong>get_vehicle_speed</strong>(bus, srcId, dstId)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the engine&#39;s current vehicle speed in km/h and mph.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_vin-instance_method" title="#get_vin (instance method)">#<strong>get_vin</strong>(bus, srcId, dstId)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Requests a VIN and formats the response as ASCII.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_vinfo_supported_pids-instance_method" title="#get_vinfo_supported_pids (instance method)">#<strong>get_vinfo_supported_pids</strong>(bus, srcId, dstId)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all the supported pids by mode 0x09 Vehicle info Returns them as an
array of ints.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_data_by_id-instance_method" title="#read_data_by_id (instance method)">#<strong>read_data_by_id</strong>(bus, srcId, dstId, id, show_error = false)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reads data from a memory region given a lookup ID value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_ecu-instance_method" title="#reset_ecu (instance method)">#<strong>reset_ecu</strong>(bus, srcId, dstId, hard, opt = {})  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Issues a reset of the ECU.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#response_hash_to_data_array-instance_method" title="#response_hash_to_data_array (instance method)">#<strong>response_hash_to_data_array</strong>(id, hash)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Helper method to take client.automotive response hashes and return a single
array in order, This takes the ISO-TP Packets and assembles them in order,
strips out the ISO-TP/UDS related info and returns just the data section as
an array.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#routine_control-instance_method" title="#routine_control (instance method)">#<strong>routine_control</strong>(bus, srcId, dstId, routine_type, id, data = [], opt = {})  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes a builtin routine.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_security_token_response-instance_method" title="#send_security_token_response (instance method)">#<strong>send_security_token_response</strong>(bus, srcId, dstId, key, response_level = 2)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends a security access tokens response to the seed request.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_tester_present-instance_method" title="#send_tester_present (instance method)">#<strong>send_tester_present</strong>(bus, srcId, dstId, suppress_response = true)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends a TestPresent message.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_dsc-instance_method" title="#set_dsc (instance method)">#<strong>set_dsc</strong>(bus, srcId, dstId, level)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set the diagnostic session code.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_data_by_id-instance_method" title="#write_data_by_id (instance method)">#<strong>write_data_by_id</strong>(bus, srcId, dstId, id, data)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Writes data by ID.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear_dtcs-instance_method">
  
    #<strong>clear_dtcs</strong>(bus, srcId, dstId, opt = {})  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clears the DTCs and Resets the MIL light back to the off position</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>No packets are expected to return but an error could be returned</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


429
430
431
432
433
434
435
436
437
438
439
440
441
442</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 429</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_dtcs'>clear_dtcs</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x04</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_calibration_id-instance_method">
  
    #<strong>get_calibration_id</strong>(bus, srcId, dstId)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the vehicle calibration ID and returns it as an ASCII string</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Calibration ID as ASCII</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


520
521
522
523
524
525
526
527
528</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 520</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_calibration_id'>get_calibration_id</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_vehicle_info'>get_vehicle_info</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x04</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UDS ERR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_packets'>packets</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_current_data-instance_method">
  
    #<strong>get_current_data</strong>(bus, srcId, dstId, pid, opt = {})  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shows the vehicles current data</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pid</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer of the PID to get data about</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>client.automotive response</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 81</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x01</span><span class='comma'>,</span> <span class='id identifier rubyid_pid'>pid</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_current_data_pids-instance_method">
  
    #<strong>get_current_data_pids</strong>(bus, srcId, dstId)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all supported pids for current data</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>All supported pids from Mode $01 get current data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_current_data_pids'>get_current_data_pids</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pids'>pids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_pids'>pids</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>    <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>0x20</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
      <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='int'>0x20</span>
    <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x20</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>      <span class='lparen'>(</span><span class='int'>0x20</span><span class='op'>..</span><span class='int'>0x40</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
        <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>0x21</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='int'>0x40</span>
    <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x40</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>      <span class='lparen'>(</span><span class='int'>0x40</span><span class='op'>..</span><span class='int'>0x60</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
        <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>0x41</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='int'>0x60</span>
    <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x60</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>      <span class='lparen'>(</span><span class='int'>0x60</span><span class='op'>..</span><span class='int'>0x80</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
        <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>0x61</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='int'>0x80</span>
    <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x80</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>      <span class='lparen'>(</span><span class='int'>0x80</span><span class='op'>..</span><span class='int'>0xA0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
        <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>0x81</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='int'>0xA0</span>
    <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0xA0</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>      <span class='lparen'>(</span><span class='int'>0xA0</span><span class='op'>..</span><span class='int'>0xC0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
        <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>0xA1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pids'>pids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='int'>0xC0</span>
    <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0xC0</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>      <span class='lparen'>(</span><span class='int'>0xC0</span><span class='op'>..</span><span class='int'>0xE0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
        <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>0xC1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_pids'>pids</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_dtcs-instance_method">
  
    #<strong>get_dtcs</strong>(bus, srcId, dstId, opt = {})  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the Diagnostic Trouble Codes (DTCs)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of DTCs</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 374</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_dtcs'>get_dtcs</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dtcs'>dtcs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x03</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UDS ERR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>%</span> <span class='int'>2</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='lparen'>(</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_step'>step</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
        <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>case</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>&amp;</span> <span class='int'>0xC0</span>
        <span class='kw'>when</span> <span class='int'>0</span>
          <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>P</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>when</span> <span class='int'>1</span>
          <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>when</span> <span class='int'>2</span>
          <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>when</span> <span class='int'>3</span>
          <span class='id identifier rubyid_code'>code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>U</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_code'>code</span> <span class='op'>+=</span> <span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>&amp;</span> <span class='int'>0x3F</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_code'>code</span> <span class='op'>+=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_dtcs'>dtcs</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_code'>code</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_dtcs'>dtcs</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_ecu_name-instance_method">
  
    #<strong>get_ecu_name</strong>(bus, srcId, dstId)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the vehicles ECU name pid 0x0A</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ECU Name as ASCII</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


537
538
539
540
541
542
543
544
545</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 537</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_ecu_name'>get_ecu_name</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_vehicle_info'>get_vehicle_info</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x0A</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UDS ERR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_packets'>packets</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_engine_coolant_temp-instance_method">
  
    #<strong>get_engine_coolant_temp</strong>(bus, srcId, dstId)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the engine coolant temprature in both Celcious and Fahrenheit</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet Hash with { "TEMP_C" =&gt; &lt;Celcious Temp&gt;, "TEMP_F" =&gt;
&lt;Fahrenheit TEmp&gt; }</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


204
205
206
207
208
209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 204</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_engine_coolant_temp'>get_engine_coolant_temp</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x05</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_celsius'>celsius</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>-</span> <span class='int'>40</span>
  <span class='id identifier rubyid_fahrenheit'>fahrenheit</span> <span class='op'>=</span> <span class='id identifier rubyid_celsius'>celsius</span> <span class='op'>*</span> <span class='int'>9</span><span class='op'>/</span><span class='int'>5</span> <span class='op'>+</span> <span class='int'>32</span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TEMP_C</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_celsius'>celsius</span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TEMP_F</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_fahrenheit'>fahrenheit</span>
  <span class='id identifier rubyid_packets'>packets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_freeze_frame_data-instance_method">
  
    #<strong>get_freeze_frame_data</strong>(bus, srcId, dstId, pid, frame, opt = {})  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shows the vehicles freeze frame data, Use the same PIDs as supported from
Mode $01 #get_current_data_pids.  You must specify which freeze frame you
want to recall data from.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pid</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer of the PID to get data about</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>frame</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Freeze Frame Number</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>client.automotive response</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 345</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_freeze_frame_data'>get_freeze_frame_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='id identifier rubyid_frame'>frame</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='id identifier rubyid_pid'>pid</span> <span class='op'>=</span> <span class='id identifier rubyid_pid'>pid</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_frame'>frame</span> <span class='op'>=</span> <span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x02</span><span class='comma'>,</span> <span class='id identifier rubyid_pid'>pid</span><span class='comma'>,</span> <span class='id identifier rubyid_frame'>frame</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_monitor_status-instance_method">
  
    #<strong>get_monitor_status</strong>(bus, srcId, dstId)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Mode $01 Pid $01 gets and parses the monitor status</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet Hash with { "MIL" =&gt; true|false "DTC_COUNT" =&gt; 0 }</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189
190
191
192
193
194</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_monitor_status'>get_monitor_status</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x01</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MIL</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>&amp;</span> <span class='int'>0xB0</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DTC_COUNT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>&amp;</span> <span class='int'>0x7F</span>
  <span class='id identifier rubyid_packets'>packets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_obd_standards-instance_method">
  
    #<strong>get_obd_standards</strong>(bus, srcId, dstId)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return which OBD standard this bus confirms to.  This method could utilizes
bitmasks but currently creates a human readable string instead.  This may
change in the future.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Description of standard</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 260</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_obd_standards'>get_obd_standards</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x1C</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OBD ERR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>case</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span>
  <span class='kw'>when</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OBD-II as defined by CARB</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>2</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OBD as defined by EPA</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>3</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OBD and OBD-II</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>4</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OBD-I</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>5</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not OBD Compliant</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>6</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EOBD Europe</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>7</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EOBD and OBD-II</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>8</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EOBD and OBD</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>9</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EOBD, OBD, OBD-II</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>10</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JOBD Japan</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>11</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JOBD and OBD-II</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>12</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JOBD and EOBD</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>13</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JOBD, EOBD, OBD-II</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>17</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Engine Manufacturer Diagnostics (EMD)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>18</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Engine Manufacturer Diagnostics Enhanced (EMD+)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>19</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty On-Board Diagnostics (Child/Partial) (HD OBD-C)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>20</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty On-Board Diagnostics (HD OBD)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>21</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>World Wide Harmonized OBD (WWH OBD)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>23</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty Euro OBD Stage I without NOx control (HD EOBD-I)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>24</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty Euro OBD Stage I with NOx control (HD EOBD-I N)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>25</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty Euro OBD Stage II without NOx control (HD EOBD-II)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>26</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty Euro OBD Stage II with NOx control (HD EOBD-II N)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>28</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Brazil OBD Phase 1 (OBDBr-1)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>29</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Brazil OBD Phase 2 (OBDBr-2)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>30</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Korean OBD (KOBD)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>31</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>India OBD I (IOBD I)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>32</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>India OBD II (IOBD II)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>33</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Heavy Duty Euro OBD Stage VI (HD EOBD-IV)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>14</span><span class='op'>..</span><span class='int'>16</span><span class='comma'>,</span><span class='int'>22</span><span class='comma'>,</span><span class='int'>27</span><span class='comma'>,</span><span class='int'>34</span><span class='op'>..</span><span class='int'>250</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Reserved</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SAE J1939 Special Meanings</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_rpms-instance_method">
  
    #<strong>get_rpms</strong>(bus, srcId, dstId)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the engine&#39;s current RPMs</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet Hash with { "RPM" =&gt; &lt;RPMs&gt; }</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


224
225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 224</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_rpms'>get_rpms</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x0C</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RPM</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>256</span> <span class='op'>*</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>+</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>4</span>
  <span class='id identifier rubyid_packets'>packets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_security_token-instance_method">
  
    #<strong>get_security_token</strong>(bus, srcId, dstId, level = 1)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Retrieves the security access token</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>level</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Requested security access level. Default is 1</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet Hash with { "SEED" =&gt; [ XX, XX ] }</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 668</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_security_token'>get_security_token</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='op'>=</span><span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_level'>level</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='int'>1</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x27</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SEED</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_packets'>packets</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_packets'>packets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_vehicle_info-instance_method">
  
    #<strong>get_vehicle_info</strong>(bus, srcId, dstId, mode, opt = {})  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Requests diagnostics 0x09 vehicle information for any given mode No
formatting is done on the response</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>client.automotive response</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


456
457
458
459
460
461
462
463
464
465
466
467
468
469
470</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 456</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_vehicle_info'>get_vehicle_info</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='id identifier rubyid_mode'>mode</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x09</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_vehicle_speed-instance_method">
  
    #<strong>get_vehicle_speed</strong>(bus, srcId, dstId)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the engine&#39;s current vehicle speed in km/h and mph</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet Hash with { "SPEED_K" =&gt; &lt;km/h&gt;, "SPEED_M" =&gt;
&lt;mph&gt; }</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


241
242
243
244
245
246
247
248
249</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 241</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_vehicle_speed'>get_vehicle_speed</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_current_data'>get_current_data</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x0D</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPEED_K</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span>
  <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPEED_M</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPEED_K</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>/</span> <span class='float'>1.609344</span>
  <span class='id identifier rubyid_packets'>packets</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_vin-instance_method">
  
    #<strong>get_vin</strong>(bus, srcId, dstId)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Requests a VIN and formats the response as ASCII</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>VIN as ASCII</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


503
504
505
506
507
508
509
510
511</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 503</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_vin'>get_vin</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_vehicle_info'>get_vehicle_info</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0x02</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UDS ERR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_packets'>packets</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_vinfo_supported_pids-instance_method">
  
    #<strong>get_vinfo_supported_pids</strong>(bus, srcId, dstId)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all the supported pids by mode 0x09 Vehicle info Returns them as an
array of ints</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of PIDS supported by Mode $09</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


481
482
483
484
485
486
487
488
489
490
491
492
493</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 481</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_vinfo_supported_pids'>get_vinfo_supported_pids</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pids'>pids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_get_vehicle_info'>get_vehicle_info</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_pids'>pids</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_packets'>packets</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span><span class='int'>6</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_hexpids'>hexpids</span> <span class='op'>=</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Array of 1s and 0s
</span>    <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>20</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>|</span>
      <span class='id identifier rubyid_pids'>pids</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_pid'>pid</span> <span class='kw'>if</span> <span class='id identifier rubyid_hexpids'>hexpids</span><span class='lbracket'>[</span><span class='id identifier rubyid_pid'>pid</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_pids'>pids</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_data_by_id-instance_method">
  
    #<strong>read_data_by_id</strong>(bus, srcId, dstId, id, show_error = false)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reads data from a memory region given a lookup ID value</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>2 Bytes in an array of the identifier.  Example [ 0xF1, 0x90 ]</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>show_error</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>If an error, return the Packet hash instead, Default false</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Data retrieved.  If show_error is true and an error is detected, then
packet hash will be returned instead</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 620</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_data_by_id'>read_data_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_show_error'>show_error</span><span class='op'>=</span><span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_show_error'>show_error</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID paramater must be a two byte array</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_show_error'>show_error</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>2</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID paramater must be a two byte array</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_show_error'>show_error</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>15</span>
  <span class='id identifier rubyid_packets'>packets</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x22</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span> <span class='op'>==</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_packets'>packets</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_packets'>packets</span> <span class='kw'>if</span> <span class='id identifier rubyid_show_error'>show_error</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_packets'>packets</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_ecu-instance_method">
  
    #<strong>reset_ecu</strong>(bus, srcId, dstId, hard, opt = {})  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Issues a reset of the ECU</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>hard</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If true a hard reset will be peformed</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>client.automtoive response (Could be no response)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


592
593
594
595
596
597
598
599
600
601
602
603
604
605
606</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 592</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_ecu'>reset_ecu</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_hard'>hard</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_reset_type'>reset_type</span> <span class='op'>=</span> <span class='id identifier rubyid_hard'>hard</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x11</span><span class='comma'>,</span> <span class='id identifier rubyid_reset_type'>reset_type</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="response_hash_to_data_array-instance_method">
  
    #<strong>response_hash_to_data_array</strong>(id, hash)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Helper method to take client.automotive response hashes and return a single
array in order, This takes the ISO-TP Packets and assembles them in order,
strips out the ISO-TP/UDS related info and returns just the data section as
an array</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hex value as string. Example: 7e0</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>hash</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hash that includes "Packets" =&gt; [ { "ID" =&gt; "0xXXX", "DATA =&gt; [
"XX", "XX" ] } ]</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Just the data portion of an ISO-TP response represented as Hex Strings</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_response_hash_to_data_array'>response_hash_to_data_array</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_data'>data</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_hash'>hash</span>
  <span class='id identifier rubyid_bad_count'>bad_count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='comment'># Not multiple packets
</span>      <span class='id identifier rubyid_pktdata'>pktdata</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_pktdata'>pktdata</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>0x7F</span>
        <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packet response was an error</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_pktdata'>pktdata</span><span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='id identifier rubyid_pktdata'>pktdata</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_data'>data</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_left2combine'>left2combine</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_left2combine'>left2combine</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_bad_count'>bad_count</span> <span class='op'>&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>2</span><span class='rparen'>)</span>
      <span class='comment'>#print_line(&quot;DEBUG Current status combine=#{left2combine} data=#{data.inspect}&quot;)
</span>      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pkt'>pkt</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span> <span class='op'>==</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_hex'>hex</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>==</span> <span class='int'>0</span>  <span class='comment'># Get starting packet
</span>              <span class='kw'>if</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10</span><span class='tstring_end'>&quot;</span></span>
                <span class='id identifier rubyid_data'>data</span> <span class='op'>+=</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>5</span><span class='comma'>,</span><span class='int'>3</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_left2combine'>left2combine</span> <span class='op'>-=</span> <span class='int'>1</span>
                <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>
              <span class='kw'>else</span>
                <span class='id identifier rubyid_bad_count'>bad_count</span> <span class='op'>+=</span> <span class='int'>1</span>
              <span class='kw'>end</span>
            <span class='kw'>else</span> <span class='comment'># Got the first packet, get the 2x series
</span>              <span class='comment'># TODO: Support rollover counter, rare but technically possible
</span>              <span class='kw'>if</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%02x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='int'>0x20</span> <span class='op'>+</span> <span class='id identifier rubyid_counter'>counter</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_data'>data</span> <span class='op'>+=</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_pkt'>pkt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_left2combine'>left2combine</span> <span class='op'>-=</span> <span class='int'>1</span>
                <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>
              <span class='kw'>else</span>
                <span class='id identifier rubyid_bad_count'>bad_count</span> <span class='op'>+=</span> <span class='int'>1</span>
              <span class='kw'>end</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_bad_count'>bad_count</span> <span class='op'>&gt;=</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packets</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>2</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bad packet count exceeded normal limits.  Packet parser failed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="routine_control-instance_method">
  
    #<strong>routine_control</strong>(bus, srcId, dstId, routine_type, id, data = [], opt = {})  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Executes a builtin routine. Routines are a series of pre-programmed
acutions setup by the manufacturer.</p>

<p>param id [Array] 2 byte Array for the routine identifier</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>routine_type</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Type or routine request. Example: 1 = Start, 3 = Report</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Array of routine data/params. Specific to the routine. Optional, Default []</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opt</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Additional options to be passed to
automotive.send_isotp_and_wait_for_response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet hash from client.automotive</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 778</span>

<span class='kw'>def</span> <span class='id identifier rubyid_routine_control'>routine_control</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_routine_type'>routine_type</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID must be an array of hex values</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA must be an array of hex values</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_routine_type'>routine_type</span> <span class='op'>=</span> <span class='id identifier rubyid_routine_type'>routine_type</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='kw'>and</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x31</span><span class='comma'>,</span> <span class='id identifier rubyid_routine_type'>routine_type</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>+</span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_security_token_response-instance_method">
  
    #<strong>send_security_token_response</strong>(bus, srcId, dstId, key, response_level = 2)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends a security access tokens response to the seed request</p>

<p>param key [Array] Array of Hex to be used as the key.  Same size as the
seed</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>response_level</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>2</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Requested security access level response. Usually level + 1. Default is 2</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>packet response from client.automotoive</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 701</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_security_token_response'>send_security_token_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_response_level'>response_level</span><span class='op'>=</span><span class='int'>2</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Key must be an array of hex values</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span> <span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_response_level'>response_level</span> <span class='op'>=</span> <span class='id identifier rubyid_response_level'>response_level</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='int'>1</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x27</span><span class='comma'>,</span> <span class='id identifier rubyid_response_level'>response_level</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_tester_present-instance_method">
  
    #<strong>send_tester_present</strong>(bus, srcId, dstId, suppress_response = true)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends a TestPresent message.  This message maintains previously set DSCs or
Security Access levels so they don&#39;t timeout and revert back to normal.
TesterPresent is typically transmitted on 2-3 second intervals</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>suppress_response</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>By default suppress ACK from ECU.  Set to false if you want confirmation</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet hash from client.automotive.  Typically blank unless
suppress_response is false</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 817</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_tester_present'>send_tester_present</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_suppress_response'>suppress_response</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_suppress'>suppress</span> <span class='op'>=</span> <span class='int'>0x80</span>
  <span class='id identifier rubyid_suppress'>suppress</span> <span class='op'>=</span> <span class='int'>0</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_suppress_reponse'>suppress_reponse</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x3E</span><span class='comma'>,</span> <span class='id identifier rubyid_suppress'>suppress</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_dsc-instance_method">
  
    #<strong>set_dsc</strong>(bus, srcId, dstId, level)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set the diagnostic session code</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>level</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The desired DSC level</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>client.automtoive response</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 561</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_dsc'>set_dsc</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_level'>level</span> <span class='op'>=</span> <span class='id identifier rubyid_level'>level</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TIMEOUT</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='int'>20</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='int'>1</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x10</span><span class='comma'>,</span> <span class='id identifier rubyid_level'>level</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_data_by_id-instance_method">
  
    #<strong>write_data_by_id</strong>(bus, srcId, dstId, id, data)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Writes data by ID</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bus</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>unique CAN bus identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>srcId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the Sending CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dstId</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Integer representation of the receiving CAN ID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>2 Bytes in an array of the identifier.  Example [ 0xF1, 0x90 ]</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of bytes to write</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Packet hash from client.automotive</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/post/hardware/automotive/uds.rb', line 736</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_data_by_id'>write_data_by_id</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not an automotive hwbridge session</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID must be an array of hex values</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_print_error'>print_error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DATA must be an array of hex values</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srcId'>srcId</span> <span class='op'>=</span> <span class='id identifier rubyid_srcId'>srcId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dstId'>dstId</span> <span class='op'>=</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_map!'>map!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Integer</span>
  <span class='id identifier rubyid_bus'>bus</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_active_bus'>active_bus</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
  <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_bus'>bus</span>
    <span class='id identifier rubyid_print_line'>print_line</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No active bus, use &#39;connect&#39; or specify bus via the options</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_opt'>opt</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MAXPKTS</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='op'>=</span><span class='int'>1</span>
  <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_automotive'>automotive</span><span class='period'>.</span><span class='id identifier rubyid_send_isotp_and_wait_for_response'>send_isotp_and_wait_for_response</span><span class='lparen'>(</span><span class='id identifier rubyid_bus'>bus</span><span class='comma'>,</span><span class='id identifier rubyid_srcId'>srcId</span><span class='comma'>,</span> <span class='id identifier rubyid_dstId'>dstId</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0x27</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>+</span> <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_opt'>opt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Feb 14 22:37:40 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.8 (ruby-2.3.1).
</div>

    </div>
  </body>
</html>